schema: '2.0'
stages:
  prepare:
    cmd: python faction-picker-bot\make_data.py --params params.yaml
    deps:
    - path: faction-picker-bot\creatingVPdata.ipynb
      md5: a77792d77b611ff3d58c4974c4aeab4d
      size: 395512
    params:
      params.yaml:
        prepare:
          folderlocation: terra-mystica/
          vp-data-dir: data/faction-picker-bot/vpdata.csv
          feature-data-dir: data/faction-picker-bot/featdata.csv
          player-drop-dir: data/faction-picker-bot/unfinishedgames.csv
    outs:
    - path: data\faction-picker-bot\featdata.csv
      md5: c70002d8b9a19a20f045d86b19256c46
      size: 11514409
    - path: data\faction-picker-bot\vpdata.csv
      md5: b532b6155ebb08303c7fa51b7f5346a1
      size: 5433991
  prepare-step2:
    cmd: python faction-picker-bot\create_individual_datasets.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\featdata.csv
      md5: c70002d8b9a19a20f045d86b19256c46
      size: 11514409
    - path: data\faction-picker-bot\vpdata.csv
      md5: b532b6155ebb08303c7fa51b7f5346a1
      size: 5433991
    - path: faction-picker-bot\create_individual_datasets.py
      md5: 7f25432a88b81c1cbaa29ab5b9470cf4
      size: 3422
    params:
      params.yaml:
        prepare:
          folderlocation: terra-mystica/
          vp-data-dir: data/faction-picker-bot/vpdata.csv
          feature-data-dir: data/faction-picker-bot/featdata.csv
          player-drop-dir: data/faction-picker-bot/unfinishedgames.csv
        prepare-step2:
          round-features: one-hot
          map-features: one-hot
          playercount-features: ordinal
          pickle-dir: data/faction-picker-bot/each-faction-data.pkl
    outs:
    - path: data\faction-picker-bot\each-faction-data.pkl
      md5: a047b34cf87c0627f0705ccc7e6e159d
      size: 222036894
  train:
    cmd: python faction-picker-bot\train_models.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\each-faction-data.pkl
      md5: a047b34cf87c0627f0705ccc7e6e159d
      size: 222036894
    - path: faction-picker-bot\create_individual_datasets.py
      md5: 7f25432a88b81c1cbaa29ab5b9470cf4
      size: 3422
    - path: faction-picker-bot\train_models.py
      md5: cdbcc210981ed0c456d788b05eabd967
      size: 6342
    params:
      params.yaml:
        training:
          model-dir: data/faction-picker-bot/models/
          model-metrics-dir: data/faction-picker-bot/model-metrics/
          training-routine: lgb_train_method
          train-proportion: 0.8
          val-proportion: 0.1
          test-proportion: 0.1
          split-rounds: 1500
          num-rounds: 40
          lgbt-model-kwargs:
            num_leaves: 31
            learning_rate: 0.1
            max_depth: -1
            boosting_type: dart
            objective: regression
            feature_fraction: 0.7
          nn-model-kwargs:
            hidden_units:
            - 8
            - 8
            learning_rate: 0.001
            batch_size: 256
            num_epochs: 100
            loss: mse
    outs:
    - path: data\faction-picker-bot\models\
      md5: 241920b40103648f6a3d3cef66f0206b.dir
      size: 1698156
      nfiles: 14
  create-metrics:
    cmd: python faction-picker-bot\create_metrics.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\models\
      md5: 241920b40103648f6a3d3cef66f0206b.dir
      size: 1698156
      nfiles: 14
    - path: faction-picker-bot\create_metrics.py
      md5: 991f6ad222ab295c597035b21cf1b859
      size: 4121
    - path: faction-picker-bot\train_models.py
      md5: cdbcc210981ed0c456d788b05eabd967
      size: 6342
    outs:
    - path: data\faction-picker-bot\metrics\
      md5: a0e17474aeadc7aab7940532cf38c60a.dir
      size: 744787
      nfiles: 14
    - path: data\faction-picker-bot\model_metrics.json
      md5: 46923d2238a8725c8d9754bd4a81c935
      size: 443
    - path: data\faction-picker-bot\model_plot_data.csv
      md5: 4f12956123b1fe8f92229a4e5f26a9d4
      size: 10396
