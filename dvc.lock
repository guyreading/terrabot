schema: '2.0'
stages:
  prepare:
    cmd: python faction-picker-bot\make_data.py --params params.yaml
    deps:
    - path: faction-picker-bot\creatingVPdata.ipynb
      md5: a77792d77b611ff3d58c4974c4aeab4d
      size: 395512
    params:
      params.yaml:
        prepare:
          folderlocation: terra-mystica/
          vp-data-dir: data/faction-picker-bot/vpdata.csv
          feature-data-dir: data/faction-picker-bot/featdata.csv
          player-drop-dir: data/faction-picker-bot/unfinishedgames.csv
    outs:
    - path: data\faction-picker-bot\featdata.csv
      md5: b0b19b2ceab05fa6af5536180f1978a5
      size: 11514409
    - path: data\faction-picker-bot\vpdata.csv
      md5: b532b6155ebb08303c7fa51b7f5346a1
      size: 5433991
  prepare-step2:
    cmd: python faction-picker-bot\create_individual_datasets.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\featdata.csv
      md5: b0b19b2ceab05fa6af5536180f1978a5
      size: 11514409
    - path: data\faction-picker-bot\vpdata.csv
      md5: b532b6155ebb08303c7fa51b7f5346a1
      size: 5433991
    - path: faction-picker-bot\create_individual_datasets.py
      md5: 37a4d007bf2d2a22ee8e6b535984adb4
      size: 3422
    params:
      params.yaml:
        prepare:
          folderlocation: terra-mystica/
          vp-data-dir: data/faction-picker-bot/vpdata.csv
          feature-data-dir: data/faction-picker-bot/featdata.csv
          player-drop-dir: data/faction-picker-bot/unfinishedgames.csv
        prepare-step2:
          round-features: one-hot
          map-features: one-hot
          playercount-features: ordinal
          pickle-dir: data/faction-picker-bot/each-faction-data.pkl
    outs:
    - path: data\faction-picker-bot\each-faction-data.pkl
      md5: f3250b2c6790d6ede9d7ea023772dc9b
      size: 219198312
  train:
    cmd: python faction-picker-bot\train_models.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\each-faction-data.pkl
      md5: f3250b2c6790d6ede9d7ea023772dc9b
      size: 219198312
    - path: faction-picker-bot\create_individual_datasets.py
      md5: 37a4d007bf2d2a22ee8e6b535984adb4
      size: 3422
    - path: faction-picker-bot\train_models.py
      md5: 69a9bf0a2e45a64c02f634ebb510bc42
      size: 4399
    params:
      params.yaml:
        training:
          model-dir: data/faction-picker-bot/models/
          model-metrics-dir: data/faction-picker-bot/model-metrics/
          training-routine: lgb_train_method
          train-proportion: 0.8
          val-proportion: 0.1
          test-proportion: 0.1
          split-rounds: 1500
          num-rounds: 10000
          model-kwargs:
            num_leaves: 50
            learning_rate: 0.005
            max_depth: 20
            boosting_type: dart
            objective: regression
            feature_fraction: 0.7
    outs:
    - path: data\faction-picker-bot\models\
      md5: 5640456644c0975cc75b43ca0beb0142.dir
      size: 656605543
      nfiles: 14
  create-metrics:
    cmd: python faction-picker-bot\create_metrics.py --params params.yaml
    deps:
    - path: data\faction-picker-bot\models\
      md5: 5640456644c0975cc75b43ca0beb0142.dir
      size: 656605543
      nfiles: 14
    - path: faction-picker-bot\create_metrics.py
      md5: 33f3e0706221fd75f97e0a10342a22c2
      size: 4056
    - path: faction-picker-bot\train_models.py
      md5: 69a9bf0a2e45a64c02f634ebb510bc42
      size: 4399
    outs:
    - path: data\faction-picker-bot\metrics\
      md5: 0128fccf7ebd3ad334d71ce43d019cc4.dir
      size: 732376
      nfiles: 14
    - path: data\faction-picker-bot\model_metrics.json
      md5: 9fa2e4bb37be8cf3726b238063dbae6b
      size: 446
    - path: data\faction-picker-bot\model_plot_data.csv
      md5: ec4d5aef362d787cc5897b90e9fdd8a0
      size: 2577914
